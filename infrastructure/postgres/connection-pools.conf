# PgBouncer Configuration for TREUM AI Finance Agency
# Optimized connection pooling for each service database

# Connection pool configurations by service workload characteristics

# User Management Service (Medium load, session-based)
[databases]
treum_users = host=postgres-users port=5432 dbname=treum_users user=treum_user_service password=user_secure_pass_2024 pool_size=20 min_pool_size=5 reserve_pool_size=5

# Trading Service (High load, high frequency)
treum_trading = host=postgres-trading port=5432 dbname=treum_trading user=treum_trading_service password=trading_secure_pass_2024 pool_size=50 min_pool_size=10 reserve_pool_size=10

# Market Data Service (Very high load, real-time)
treum_market_data = host=postgres-market-data port=5432 dbname=treum_market_data user=treum_market_data_service password=market_data_secure_pass_2024 pool_size=100 min_pool_size=20 reserve_pool_size=20

# Signals Service (Medium load, analytical)
treum_signals = host=postgres-signals port=5432 dbname=treum_signals user=treum_signals_service password=signals_secure_pass_2024 pool_size=30 min_pool_size=5 reserve_pool_size=8

# Payments Service (Medium load, ACID critical)
treum_payments = host=postgres-payments port=5432 dbname=treum_payments user=treum_payments_service password=payments_secure_pass_2024 pool_size=25 min_pool_size=8 reserve_pool_size=5

# Notifications Service (High load, burst writes)
treum_notifications = host=postgres-notifications port=5432 dbname=treum_notifications user=treum_notifications_service password=notifications_secure_pass_2024 pool_size=40 min_pool_size=10 reserve_pool_size=10

# Risk Management Service (Medium load, real-time monitoring)
treum_risk = host=postgres-risk port=5432 dbname=treum_risk user=treum_risk_service password=risk_secure_pass_2024 pool_size=35 min_pool_size=8 reserve_pool_size=8

# Education Service (Medium load, content delivery)
treum_education = host=postgres-education port=5432 dbname=treum_education user=treum_education_service password=education_secure_pass_2024 pool_size=25 min_pool_size=5 reserve_pool_size=5

[pgbouncer]
# Global settings
listen_port = 5432
listen_addr = 0.0.0.0
auth_type = plain
auth_file = /etc/pgbouncer/userlist.txt

# Pool configuration by service type
pool_mode = transaction
max_client_conn = 1000
default_pool_size = 25

# Connection lifecycle
server_round_robin = 1
ignore_startup_parameters = extra_float_digits

# Performance tuning
server_idle_timeout = 600
server_connect_timeout = 15
server_login_retry = 15
query_timeout = 0
query_wait_timeout = 120
client_idle_timeout = 0
client_login_timeout = 60

# Logging and monitoring
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1
stats_period = 60

# Security
disable_pqexec = 0
application_name_add_host = 1

# Service-specific optimizations
# High-frequency trading connections
max_db_connections = 100
max_user_connections = 100

# Administrative settings
admin_users = postgres, treum_admin
stats_users = stats, treum_monitoring